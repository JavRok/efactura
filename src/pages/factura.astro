---
import Layout from "../layouts/Layout.astro";
import EditableText from "../components/EditableText";
import EditableCell from "../components/EditableCell";
import InvoiceLines from "../components/InvoiceLines";
import type { InvoiceLine } from "../stores/invoiceStore";
import { getInvoiceField } from "../stores/invoiceStore";

const invoiceLines: InvoiceLine[] = getInvoiceField("invoiceLines");
---

<Layout title="Formulario de prueba">
  <main class="min-h-screen bg-gray-100 py-8">
    <h1 class="max-w-4xl mx-auto text-2xl font-bold text-gray-800 mb-3">
      Factura de prueba
    </h1>
    <p class="max-w-4xl mx-auto mb-6">
      Modifica la factura con los datos reales
    </p>

    <div class="max-w-4xl mx-auto p-6 bg-white rounded-sm shadow-md">
      <!-- Invoice Header -->
      <div class="flex justify-between items-start mb-10">
        <div>
          <h1 class="text-5xl font-bold mb-4">FACTURA</h1>
          <div class="border-2 border-black p-2 w-64">
            <div class="flex font-semibold">
              Nº:&nbsp;
              <EditableText
                client:load
                name="invoiceNumber"
                maxLength={20}
                className="px-2"
              />
            </div>
          </div>
        </div>
        <div class="text-6xl font-light">B</div>
      </div>

      <!-- Client and Company Information -->
      <div class="flex mb-10">
        <div class="w-1/2 pr-8">
          <h2 class="font-bold text-lg mb-2">DATOS DEL CLIENTE</h2>
          <EditableText client:load name="myCompanyName" />
          <EditableText client:load name="myCompanyEmail" />
          <EditableText client:load name="myCompanyPhone" />
          <EditableText client:load name="myCompanyAddress" />
        </div>
        <div class="border-l border-gray-400"></div>
        <div class="w-1/2 pl-8">
          <h2 class="font-bold text-lg mb-2">DATOS DE LA EMPRESA</h2>
          <EditableText client:load name="companyName" />
          <EditableText client:load name="companyEmail" />
          <EditableText client:load name="companyPhone" />
          <EditableText client:load name="companyAddress" />
        </div>
      </div>

      <!-- Invoice Items -->
      <div class="mb-10">
        <table class="w-full border-2 border-black">
          <thead>
            <tr class="border-b-2 border-black">
              <th class="text-left p-2 w-1/2">Detalle</th>
              <th class="text-center p-2">Cantidad</th>
              <th class="text-center p-2">Precio</th>
              <th class="text-center p-2">Total</th>
            </tr>
          </thead>

          <tbody>
            {
              invoiceLines &&
                invoiceLines.map((line, index) => (
                  <tr class="border-b border-gray-200">
                    <td class="p-2">
                      <EditableCell
                        client:load
                        index={index}
                        field="detail"
                        initialValue={line.detail}
                      />
                    </td>
                    <td class="text-center p-2">
                      <EditableCell
                        client:load
                        index={index}
                        field="quantity"
                        initialValue={line.quantity}
                      />
                    </td>
                    <td class="text-center p-2">
                      <EditableCell
                        client:load
                        index={index}
                        field="unitPrice"
                        initialValue={line.unitPrice}
                      />
                    </td>
                    <td class="text-center p-2">
                      <EditableCell
                        client:load
                        index={index}
                        field="totalPrice"
                        initialValue={line.totalPrice}
                      />
                    </td>
                  </tr>
                ))
            }
          </tbody>

          <!--<tbody>-->
          <!--  <tr class="border-b border-gray-200">-->
          <!--    <td class="p-2">Desarrollo Web Responsive</td>-->
          <!--    <td class="text-center p-2">01</td>-->
          <!--    <td class="text-center p-2">1.200 €</td>-->
          <!--    <td class="text-center p-2">1.200 €</td>-->
          <!--  </tr>-->
          <!--  <tr class="border-b border-gray-200">-->
          <!--    <td class="p-2">Optimización SEO</td>-->
          <!--    <td class="text-center p-2">01</td>-->
          <!--    <td class="text-center p-2">450 €</td>-->
          <!--    <td class="text-center p-2">450 €</td>-->
          <!--  </tr>-->
          <!--  <tr class="border-b border-gray-200">-->
          <!--    <td class="p-2">Campaña Marketing Digital</td>-->
          <!--    <td class="text-center p-2">01</td>-->
          <!--    <td class="text-center p-2">750 €</td>-->
          <!--    <td class="text-center p-2">750 €</td>-->
          <!--  </tr>-->
          <!--</tbody>-->
        </table>
      </div>

      <!-- Divider -->
      <div class="border-t border-gray-400 my-6"></div>

      <!-- Tax and Total -->
      <div class="flex justify-end mb-10">
        <table class="w-1/2">
          <tr>
            <td class="p-2">IVA</td>
            <td class="text-center p-2">21 %</td>
            <td class="text-center p-2">756 €</td>
          </tr>
          <tr class="border-2 border-black">
            <td class="p-2 font-bold">TOTAL</td>
            <td class="text-center p-2"></td>
            <td class="text-center p-2 font-bold">4.356 €</td>
          </tr>
        </table>
      </div>

      <!-- Payment Information -->
      <div class="mb-10">
        <div class="border-2 border-black p-4 w-96">
          <h2 class="font-bold text-lg mb-2">INFORMACIÓN DE PAGO</h2>
          <p>Transferencia bancaria</p>
          <p>Banco Santander</p>
          <p>Nombre: Servicios Digitales XYZ</p>
          <p>IBAN: ES91 2100 0418 4502 0005 1332</p>
          <p>SWIFT/BIC: CAIXESBBXXX</p>
        </div>
      </div>

      <!-- Footer -->
      <div class="text-center mt-16 pt-4 border-t border-gray-400">
        <p class="text-lg font-semibold">WWW.SERVICIOSDIGITALESXYZ.ES</p>
      </div>
    </div>
  </main>
</Layout>
